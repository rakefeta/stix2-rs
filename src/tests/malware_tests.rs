use crate::domain_obj::malware::Malware;
use serde_json;

// Datetime format for STIX2 datetime (de)serialization
// const STIX2_DTFORMAT: &str = "%Y-%m-%dT%H:%M:%S%.3fZ";

#[test]
fn malware_deserialization() {

    let json_str = r#"
        {
            "type": "malware",
            "spec_version": "2.1",
            "id": "malware--0c7b5b88-8ff7-4a4d-aa9d-feb398cd0061",
            "created": "2016-05-12T08:17:27.000Z",
            "modified": "2016-05-12T08:17:27.000Z",
            "name": "Cryptolocker",
            "description": "A variant of the cryptolocker family",
            "malware_types": ["ransomware"],
            "is_family": false
        }"#;

    let _parsed_json: Malware = serde_json::from_str(&json_str).unwrap();
}

#[test]
fn malware_deserialization_without_optional_field() {

    let json_str: &str = r#"
        {
            "type": "malware",
            "spec_version": "2.1",
            "id": "malware--0c7b5b88-8ff7-4a4d-aa9d-feb398cd0061",
            "created": "2016-05-12T08:17:27.000Z",
            "modified": "2016-05-12T08:17:27.000Z",
            "name": "Cryptolocker",
            "description": "A variant of the cryptolocker family",
            "malware_types": ["ransomware", "remote-access-trojan"],
            "is_family": false
        }"#;

    let _parsed_json: Malware = serde_json::from_str(&json_str).unwrap();
}

#[test]
#[should_panic]
fn malware_deserialization_without_required_field() {
    
    // "is_family" required field is missing
    let json_str: &str = r#"
        {
            "type": "malware",
            "spec_version": "2.1",
            "id": "malware--0c7b5b88-8ff7-4a4d-aa9d-feb398cd0061",
            "created": "2016-05-12T08:17:27.000Z",
            "modified": "2016-05-12T08:17:27.000Z",
            "name": "Cryptolocker",
            "description": "A variant of the cryptolocker family",
            "malware_types": ["ransomware", "remote-access-trojan"]
        }"#;

    let _parsed_json: Malware = serde_json::from_str(&json_str).unwrap();
}